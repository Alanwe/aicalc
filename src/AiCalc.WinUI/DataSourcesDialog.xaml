<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="AiCalc.DataSourcesDialogContent"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:AiCalc.Models"
    mc:Ignorable="d">
    
<Grid x:Name="RootGrid" Padding="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240" />
            <ColumnDefinition Width="20" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <StackPanel Grid.ColumnSpan="3" Orientation="Vertical" Spacing="4" Margin="0,0,0,8">
            <TextBlock Text="Manage cloud storage accounts for Azure Blob Storage, AWS S3, and Google Cloud Storage." 
                       TextWrapping="WrapWholeWords" 
                       Foreground="{ThemeResource TextSecondaryBrush}" />
        </StackPanel>

        <StackPanel Grid.Row="1" Grid.Column="0" Spacing="8">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Content="Add" Click="AddConnection_Click" />
                <Button Content="Remove" Click="RemoveConnection_Click" />
            </StackPanel>
            <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                <ListView x:Name="ConnectionsList" 
                          ItemsSource="{x:Bind EditableConnections}" 
                          SelectionMode="Single" 
                          SelectedItem="{x:Bind SelectedConnection, Mode=TwoWay}" 
                          SelectionChanged="ConnectionsList_SelectionChanged"
                          IsItemClickEnabled="False" 
                          HorizontalAlignment="Stretch" 
                          VerticalAlignment="Stretch">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="models:CloudStorageConnection">
                            <StackPanel Spacing="4" Padding="10,8">
                                <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold" FontSize="13" />
                                <TextBlock Text="{x:Bind Provider}" FontSize="11" Foreground="{ThemeResource AccentTextFillColorSecondaryBrush}" />
                            </StackPanel>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Border>
        </StackPanel>

        <Border Grid.Row="1" Grid.Column="2" Padding="20" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
            <Grid>
                <ScrollViewer VerticalScrollMode="Auto" HorizontalScrollBarVisibility="Disabled" Visibility="{x:Bind DetailsVisibility, Mode=OneWay}" Padding="0,0,12,0">
                    <StackPanel Spacing="16">
                    <StackPanel Spacing="12">
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Connection Details" FontWeight="SemiBold" FontSize="18" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" VerticalAlignment="Center" />
                            <Button x:Name="TestConnectionButton"
                                Grid.Column="1"
                                Content="Test Connection"
                                Style="{StaticResource AccentButtonStyle}"
                                Click="TestConnection_Click"
                                IsEnabled="{x:Bind IsTestConnectionEnabled, Mode=OneWay}" />
                        </Grid>
                        <Rectangle Height="1" Fill="{ThemeResource DividerStrokeColorDefaultBrush}" Margin="0,0,0,4" />
                    </StackPanel>

                    <InfoBar x:Name="TestResultInfo"
                             IsOpen="False"
                             Severity="Informational"
                             Margin="0,0,0,4" />

                    <TextBox x:Name="DisplayNameBox"
                             Header="Display Name" 
                             PlaceholderText="Marketing Data Lake" 
                             Text="{x:Bind SelectedConnection.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             TextChanged="DisplayNameBox_TextChanged"
                             HorizontalAlignment="Stretch" />

                    <ComboBox x:Name="ProviderBox"
                              Header="Provider" 
                              SelectedItem="{x:Bind SelectedConnection.Provider, Mode=TwoWay}" 
                              ItemsSource="{x:Bind Providers}"
                              SelectionChanged="ProviderBox_SelectionChanged"
                              HorizontalAlignment="Stretch" />

                    <Border x:Name="AzureFields" Visibility="{x:Bind AzureFieldsVisibility, Mode=OneWay}" Background="{ThemeResource LayerFillColorAltBrush}" CornerRadius="6" Padding="16" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <StackPanel Spacing="12">
                            <TextBlock Text="â˜ï¸ Azure Storage credentials" FontWeight="SemiBold" Foreground="{ThemeResource AccentTextFillColorSecondaryBrush}" FontSize="14" />
                        <TextBox x:Name="AzureAccountNameBox"
                                 Header="Storage account name" 
                                 PlaceholderText="mystorageaccount" 
                                 Text="{x:Bind SelectedConnection.AzureStorageAccountName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 TextChanged="AzureAccountNameBox_TextChanged" />
                            <PasswordBox x:Name="AzureAccessKeyBox" Header="Access key" PasswordChanged="AzureAccessKeyBox_PasswordChanged" />
                            <PasswordBox x:Name="AzureConnectionStringBox" Header="Connection string" PasswordChanged="AzureConnectionStringBox_PasswordChanged" />
                            <Border Background="{ThemeResource SystemFillColorAttentionBackgroundBrush}" CornerRadius="4" Padding="10,6">
                                <TextBlock Text="ðŸ’¡ Provide either an access key or a full connection string." Foreground="{ThemeResource TextSecondaryBrush}" FontSize="11" TextWrapping="Wrap" />
                            </Border>
                        </StackPanel>
                    </Border>

                    <Border x:Name="AwsFields" Visibility="{x:Bind AwsFieldsVisibility, Mode=OneWay}" Background="{ThemeResource LayerFillColorAltBrush}" CornerRadius="6" Padding="16" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <StackPanel Spacing="12">
                            <TextBlock Text="â˜ï¸ AWS S3 credentials" FontWeight="SemiBold" Foreground="{ThemeResource AccentTextFillColorSecondaryBrush}" FontSize="14" />
                        <TextBox Header="Access key ID" 
                                 PlaceholderText="AKIA..." 
                                 Text="{x:Bind SelectedConnection.AwsAccessKeyId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 TextChanged="CredentialField_TextChanged" />
                        <PasswordBox x:Name="AwsSecretKeyBox" Header="Secret access key" PasswordChanged="AwsSecretKeyBox_PasswordChanged" />
                            <TextBox Header="Region" 
                                     PlaceholderText="us-east-1" 
                                     Text="{x:Bind SelectedConnection.AwsRegion, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     TextChanged="CredentialField_TextChanged" />
                        </StackPanel>
                    </Border>

                    <Border x:Name="GoogleFields" Visibility="{x:Bind GoogleFieldsVisibility, Mode=OneWay}" Background="{ThemeResource LayerFillColorAltBrush}" CornerRadius="6" Padding="16" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <StackPanel Spacing="12">
                            <TextBlock Text="â˜ï¸ Google Cloud Storage credentials" FontWeight="SemiBold" Foreground="{ThemeResource AccentTextFillColorSecondaryBrush}" FontSize="14" />
                        <TextBox Header="Project ID" 
                                 PlaceholderText="my-gcp-project" 
                                 Text="{x:Bind SelectedConnection.GoogleProjectId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 TextChanged="CredentialField_TextChanged" />
                        <TextBox Header="Client email" 
                                 PlaceholderText="service-account@project.iam.gserviceaccount.com" 
                                 Text="{x:Bind SelectedConnection.GoogleClientEmail, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 TextChanged="CredentialField_TextChanged" />
                            <TextBox Header="Service account JSON"
                                     PlaceholderText="Paste the service account JSON here"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     Height="140"
                                     Text="{x:Bind SelectedConnection.GoogleJsonKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     TextChanged="CredentialField_TextChanged" />
                        </StackPanel>
                    </Border>
                    </StackPanel>
                </ScrollViewer>

                <StackPanel Visibility="{x:Bind EmptyStateVisibility, Mode=OneWay}" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="6">
                    <TextBlock Text="Select a data source on the left to edit details." Foreground="{ThemeResource TextSecondaryBrush}" TextAlignment="Center" />
                    <TextBlock Text="Use Add to create a new connection." Foreground="{ThemeResource TextSecondaryBrush}" FontSize="12" TextAlignment="Center" />
                </StackPanel>
            </Grid>
        </Border>
</Grid>
</UserControl>
