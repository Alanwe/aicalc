<?xml version="1.0" encoding="utf-8"?>
<ContentDialog
    x:Class="AiCalc.ServiceConnectionDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="AI Service Connection"
    PrimaryButtonText="Save"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    PrimaryButtonClick="SaveButton_Click">

    <ScrollViewer MaxHeight="500" MaxWidth="500">
        <StackPanel Spacing="16" Padding="4">
            <TextBox x:Name="NameTextBox"
                     Header="Service Name *"
                     PlaceholderText="e.g., Azure OpenAI Production"
                     Text="{x:Bind Connection.Name, Mode=TwoWay}" />

            <ComboBox x:Name="ProviderComboBox"
                      Header="Provider *"
                      SelectedValuePath="Tag"
                      SelectedValue="{x:Bind Connection.Provider, Mode=TwoWay}"
                      HorizontalAlignment="Stretch">
                <ComboBoxItem Content="Azure OpenAI" Tag="AzureOpenAI" />
                <ComboBoxItem Content="OpenAI (Coming Soon)" Tag="OpenAI" IsEnabled="False" />
                <ComboBoxItem Content="Local (Ollama)" Tag="Ollama" />
            </ComboBox>

            <TextBox x:Name="EndpointTextBox"
                     Header="Endpoint *"
                     PlaceholderText="e.g., https://your-resource.openai.azure.com/"
                     Text="{x:Bind Connection.Endpoint, Mode=TwoWay}" />

            <PasswordBox x:Name="ApiKeyPasswordBox"
                         Header="API Key"
                         PlaceholderText="Enter your API key"
                         PasswordChanged="ApiKeyPasswordBox_PasswordChanged" />

            <TextBox x:Name="ModelTextBox"
                     Header="Text Model *"
                     PlaceholderText="e.g., gpt-4, claude-3-opus"
                     Text="{x:Bind Connection.Model, Mode=TwoWay}" />

            <TextBox x:Name="VisionModelTextBox"
                     Header="Vision Model (Optional)"
                     PlaceholderText="e.g., gpt-4-vision-preview, llava"
                     Text="{x:Bind Connection.VisionModel, Mode=TwoWay}" />

            <TextBox x:Name="ImageModelTextBox"
                     Header="Image Generation Model (Optional)"
                     PlaceholderText="e.g., dall-e-3"
                     Text="{x:Bind Connection.ImageModel, Mode=TwoWay}" />

            <TextBox x:Name="DeploymentTextBox"
                     Header="Deployment Name (Azure only)"
                     PlaceholderText="e.g., gpt-4-deployment"
                     Text="{x:Bind Connection.Deployment, Mode=TwoWay}" />

            <Expander Header="Performance Settings" IsExpanded="False">
                <StackPanel Spacing="12" Padding="8">
                    <NumberBox x:Name="TimeoutNumberBox"
                              Header="Timeout (seconds)"
                              Value="{x:Bind Connection.TimeoutSeconds, Mode=TwoWay}"
                              Minimum="10"
                              Maximum="300"
                              SpinButtonPlacementMode="Inline" />

                    <NumberBox x:Name="MaxRetriesNumberBox"
                              Header="Max Retries"
                              Value="{x:Bind Connection.MaxRetries, Mode=TwoWay}"
                              Minimum="0"
                              Maximum="10"
                              SpinButtonPlacementMode="Inline" />

                    <Slider x:Name="TemperatureSlider"
                           Header="Temperature (Creativity)"
                           Value="{x:Bind Connection.Temperature, Mode=TwoWay}"
                           Minimum="0"
                           Maximum="2"
                           StepFrequency="0.1"
                           TickFrequency="0.5"
                           TickPlacement="BottomRight" />
                    <TextBlock Text="{x:Bind TemperatureSlider.Value, Mode=OneWay}" 
                              FontSize="12" 
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                </StackPanel>
            </Expander>

            <Button x:Name="TestConnectionButton"
                   Content="Test Connection"
                   Click="TestConnection_Click"
                   HorizontalAlignment="Stretch"
                   Margin="0,8,0,0" />

            <TextBlock x:Name="ConnectionStatusText"
                      Visibility="Collapsed"
                      TextWrapping="Wrap"
                      FontSize="12"
                      Margin="0,4,0,0" />

            <InfoBar Title="Connection Tips"
                     Severity="Informational"
                     IsOpen="True"
                     IsClosable="False">
                <InfoBar.Content>
                    <StackPanel Spacing="4">
                        <TextBlock TextWrapping="Wrap" FontSize="12">
                            <Run Text="• Azure OpenAI: Use format https://[resource].openai.azure.com/" />
                        </TextBlock>
                        <TextBlock TextWrapping="Wrap" FontSize="12">
                            <Run Text="• OpenAI: Endpoint is https://api.openai.com/v1" />
                        </TextBlock>
                        <TextBlock TextWrapping="Wrap" FontSize="12">
                            <Run Text="• Local/Ollama: Use http://localhost:11434" />
                        </TextBlock>
                    </StackPanel>
                </InfoBar.Content>
            </InfoBar>

            <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="12">
                <StackPanel Spacing="8">
                    <TextBlock Text="Quick Presets" 
                               FontWeight="SemiBold" 
                               FontSize="12" />
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Content="Azure OpenAI" 
                                Click="PresetAzureOpenAI_Click"
                                Style="{StaticResource AccentButtonStyle}"
                                FontSize="12"
                                Padding="8,4" />
                        <Button Content="OpenAI" 
                                Click="PresetOpenAI_Click"
                                FontSize="12"
                                Padding="8,4" />
                        <Button Content="Local Ollama" 
                                Click="PresetOllama_Click"
                                FontSize="12"
                                Padding="8,4" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>
